<!DOCTYPE html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>target()</title><meta name="supported-color-schemes" content="light dark"><meta name="theme-color" content="hsl(220, 20%, 100%)" media="(prefers-color-scheme: light)"><meta name="theme-color" content="hsl(220, 20%, 10%)" media="(prefers-color-scheme: dark)"><link rel="stylesheet" href="/Site-33/pagefind/pagefind-ui.css"><link rel="stylesheet" href="/Site-33/styles.css"><link rel="canonical" href="/Site-33/3-software/nomake/2-core/target/"><link rel="icon" sizes="48x48" href="/Site-33/favicon.ico">
<link rel="apple-touch-icon" sizes="180x180" href="/Site-33/apple-touch-icon.png">
<script type="text/javascript" src="/Site-33/pagefind/pagefind-ui.js"></script><script type="text/javascript">window.addEventListener('DOMContentLoaded',()=>{new PagefindUI({"element":"#search","showImages":false,"excerptLength":0,"showEmptyFilters":true,"showSubResults":false,"resetStyles":true,"bundlePath":"/Site-33/pagefind/","baseUrl":"/Site-33/"});});</script></head><body><div></div><div class="container"><div class="toolbar"><div id="search" class="search"></div></div><nav class="menu-container"><a class="menu-highlight" href="/Site-33/">Site-33 by thautwarm</a><ul class="menu"></ul></nav><nav class="toc"><h2>On this page</h2><ol><li><a href="#parameters">Parameters</a></li><li><a href="#retrieving-the-computed-target-name">Retrieving the Computed Target Name</a></li><li><a href="#type-safe-retrieval-of-dependencies">Type-safe Retrieval of Dependencies</a></li><li><a href="#grouping-dependencies">Grouping Dependencies</a></li><li><a href="#virtual-targets">Virtual Targets</a></li><li><a href="#caching-%26-rebuilding">Caching &amp; Rebuilding</a></li><li><a href="#adding-documentations">Adding Documentations</a></li></ol></nav><main class="main"><nav><ul class="breadcrumb"><li class="breadcrumb-item"><a href="/Site-33/">Site-33 by thautwarm</a></li><li class="breadcrumb-item"><a href="/Site-33/3-software/">Software 软件</a></li><li class="breadcrumb-item"><a href="/Site-33/3-software/nomake/">NoMake</a></li><li class="breadcrumb-item"><a href="/Site-33/3-software/nomake/2-core/">Core Build Operations</a></li></ul></nav><div class="body" data-pagefind-body="true"><em> 此文档创建于 2024/5/13 </em><em style="float: right"> 更新时间 2025/3/7 </em><div><h1><code>target()</code></h1>
<p>The <code>target()</code> function defines a target in the build system.</p>
<h2 id="parameters" tabindex="-1"><a href="#parameters" class="header-anchor">Parameters</a></h2>
<ul>
<li>
<p><code>name: string</code></p>
<p>A unique identifier for the target. Responsible for invoking, distinguishing and caching the target. If the target is an artifact, it should be a file path (string).</p>
</li>
<li>
<p><code>deps?: Dependencies</code></p>
<p>Dependencies of this target.
If a dependency is an artifact, it should be a file path (string).</p>
</li>
<li>
<p><code>virtual?: boolean</code></p>
<p>If the target is virtual (i.e. no artifact, analogous to PHONY in Makefile).</p>
</li>
<li>
<p><code>doc?: string</code></p>
<p>The documentation of the target.</p>
</li>
<li>
<p><code>rebuild?: 'always' | 'never' | 'onChanged'</code></p>
<p>The rebuild mode of the target.</p>
<ul>
<li><code>always</code>: always rebuild the target.</li>
<li><code>never</code>: never rebuild the target.</li>
<li><code>onChanged</code>: rebuild the target if any of its dependencies has been changed. When the dependencies are not specified, the target will always be rebuilt. <code>onChanged</code> will not track the changes of directory contents.</li>
</ul>
</li>
<li>
<p><code>logError?: boolean</code></p>
<p>Whether to log errors when building the target fails (default to true).</p>
</li>
<li>
<p><code>build: (arg: { deps: InferTargets, target: string }) =&gt; void | Promise&lt;void&gt;</code></p>
<p>The build logic of the target.</p>
</li>
</ul>
<details>
<summary> Reference source code. </summary>

<div style="position: relative">
	<pre><code class="language-typescript hljs"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">TargetParams</span>
{
    <span class="hljs-comment">/**
     * A unique identifier for the target.
     *
     * Responsible for invoking, distinguishing and caching the target.
     */</span>
    <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>,
    <span class="hljs-comment">/**
     * Dependencies of the target.
     *
     * If a dependency is an artifact, it should be a file path (string).
     */</span>
    deps?: <span class="hljs-title class_">Deps</span>,
    <span class="hljs-comment">/**
     * If the target is virtual (i.e. no artifact, analogous to PHONY in Makefile).
     */</span>
    virtual?: <span class="hljs-built_in">boolean</span>,
    <span class="hljs-comment">/**
     * The documentation of the target.
     */</span>
    doc?: <span class="hljs-built_in">string</span>,
    <span class="hljs-comment">/**
     * The build logic of the target.
     */</span>
    <span class="hljs-attr">build</span>: <span class="hljs-function">(<span class="hljs-params">arg: { deps: InferencedDeps, target: <span class="hljs-built_in">string</span> }</span>) =&gt;</span> <span class="hljs-built_in">void</span> | <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt;,
    <span class="hljs-comment">/**
     *
     * The rebuild mode of the target.
     *
     * - 'always': always rebuild the target.
     *
     * - 'never': never rebuild the target.
     *
     * - 'onChanged': rebuild the target if any of its dependencies has been changed.
     *
     * !!! PS1: when the dependencies are not specified, the target will always be rebuilt.
     *
     * !!! PS2: 'onChanged' will not track the changes of directory contents
     */</span>
    rebuild?: <span class="hljs-string">'always'</span> | <span class="hljs-string">'never'</span> | <span class="hljs-string">'onChanged'</span>,

    <span class="hljs-comment">/**
     *
     * Whether to log errors when building the target fails (default to true).
     */</span>
    logError?: <span class="hljs-built_in">boolean</span>
}
</code></pre>

	<button class="code-copy-button" data-clipboard-text="interface TargetParams
{
    /**
     * A unique identifier for the target.
     *
     * Responsible for invoking, distinguishing and caching the target.
     */
    name: string,
    /**
     * Dependencies of the target.
     *
     * If a dependency is an artifact, it should be a file path (string).
     */
    deps?: Deps,
    /**
     * If the target is virtual (i.e. no artifact, analogous to PHONY in Makefile).
     */
    virtual?: boolean,
    /**
     * The documentation of the target.
     */
    doc?: string,
    /**
     * The build logic of the target.
     */
    build: (arg: { deps: InferencedDeps, target: string }) => void | Promise<void>,
    /**
     *
     * The rebuild mode of the target.
     *
     * - 'always': always rebuild the target.
     *
     * - 'never': never rebuild the target.
     *
     * - 'onChanged': rebuild the target if any of its dependencies has been changed.
     *
     * !!! PS1: when the dependencies are not specified, the target will always be rebuilt.
     *
     * !!! PS2: 'onChanged' will not track the changes of directory contents
     */
    rebuild?: 'always' | 'never' | 'onChanged',

    /**
     *
     * Whether to log errors when building the target fails (default to true).
     */
    logError?: boolean
}
">
        <span class="code-copy-icon"></span>
    </button>
</div>
</details>
<h2 id="retrieving-the-computed-target-name" tabindex="-1"><a href="#retrieving-the-computed-target-name" class="header-anchor">Retrieving the Computed Target Name</a></h2>
<p>In practice, the <code>name</code> parameter of the <code>build</code> function may be a computed one. Hence, we might reference the target name in the build logic using the <code>target</code> parameter.</p>

<div style="position: relative">
	<pre><code class="language-typescript hljs"><span class="hljs-variable constant_">NM</span>.<span class="hljs-title function_">target</span>(
    {
        <span class="hljs-attr">name</span>: <span class="hljs-string">'output.txt'</span>,
        <span class="hljs-keyword">async</span> <span class="hljs-title function_">build</span>(<span class="hljs-params"> { target } </span>)
        {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(target) <span class="hljs-comment">// 'output.txt'</span>
        }
    })
</code></pre>

	<button class="code-copy-button" data-clipboard-text="NM.target(
    {
        name: 'output.txt',
        async build( { target } )
        {
            console.log(target) // 'output.txt'
        }
    })
">
        <span class="code-copy-icon"></span>
    </button>
</div>
<h2 id="type-safe-retrieval-of-dependencies" tabindex="-1"><a href="#type-safe-retrieval-of-dependencies" class="header-anchor">Type-safe Retrieval of Dependencies</a></h2>
<p>The <code>deps</code> parameter of <code>target()</code> have multiple forms that ease the retrieval of dependencies in the build logic using a type-safe manner.</p>
<p>A dependency can be the following cases:</p>
<ol>
<li><code>string</code></li>
<li>the return of <code>target()</code> (type: <code>Target</code>)</li>
<li>an array of the above types or an async generator of the above types.</li>
<li>a record with the above types as values.</li>
</ol>
<p>The source code defines the following types including <code>BuildDependency</code>:</p>
<p><a name="dependency-def"> </a></p>

<div style="position: relative">
	<pre><code class="language-typescript hljs"><span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> <span class="hljs-title class_">BuildDependency</span> =
    | <span class="hljs-built_in">string</span>
    | <span class="hljs-title class_">Target</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> <span class="hljs-title class_">BuildDependencySugar</span> =
    | <span class="hljs-title class_">AsyncGenerator</span>&lt;<span class="hljs-title class_">BuildDependency</span>, <span class="hljs-built_in">any</span>, <span class="hljs-built_in">any</span>&gt;
    | <span class="hljs-title class_">BuildDependency</span>[]
    | <span class="hljs-title class_">BuildDependency</span>

<span class="hljs-comment">// the type of `deps` in `target()`</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> <span class="hljs-title class_">BuildDependencies</span> =
    | <span class="hljs-title class_">BuildDependencySugar</span>
    | { [<span class="hljs-attr">key</span>: <span class="hljs-built_in">string</span>]: <span class="hljs-title class_">BuildDependencySugar</span> }
</code></pre>

	<button class="code-copy-button" data-clipboard-text="export type BuildDependency =
    | string
    | Target

export type BuildDependencySugar =
    | AsyncGenerator<BuildDependency, any, any>
    | BuildDependency[]
    | BuildDependency

// the type of `deps` in `target()`
export type BuildDependencies =
    | BuildDependencySugar
    | { [key: string]: BuildDependencySugar }
">
        <span class="code-copy-icon"></span>
    </button>
</div>
<p>When retrieving dependencies in the build logic, the <code>deps</code> parameter gives you an "inferenced" result of your dependencies:</p>

<div style="position: relative">
	<pre><code class="language-typescript hljs"><span class="hljs-keyword">const</span> <span class="hljs-attr">list_targets</span>: <span class="hljs-variable constant_">NM</span>.<span class="hljs-property">Target</span>[] = [<span class="hljs-variable constant_">NM</span>.<span class="hljs-title function_">target</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">'b.txt'</span>, ... })]
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span>* <span class="hljs-title function_">async_targets</span>(<span class="hljs-params"></span>)
{
    <span class="hljs-keyword">yield</span> <span class="hljs-string">'c.txt'</span>
    <span class="hljs-keyword">for</span> <span class="hljs-keyword">await</span> (...) <span class="hljs-keyword">yield</span> ...
}

<span class="hljs-variable constant_">NM</span>.<span class="hljs-title function_">target</span>(
    {
        <span class="hljs-attr">name</span>: <span class="hljs-string">'build'</span>,
        <span class="hljs-attr">virtual</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// like phony in Makefile</span>
        <span class="hljs-attr">deps</span>: { <span class="hljs-attr">a</span>: <span class="hljs-string">'a.txt'</span>, <span class="hljs-attr">b</span>: list_targets, <span class="hljs-attr">c</span>: async_targets },
        <span class="hljs-keyword">async</span> <span class="hljs-title function_">build</span>(<span class="hljs-params">{ deps }</span>)
        {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(deps.<span class="hljs-property">a</span>)  <span class="hljs-comment">// 'a.txt'</span>
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(deps.<span class="hljs-property">b</span>)  <span class="hljs-comment">//  [ 'b.txt' ]</span>
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(deps.<span class="hljs-property">c</span>)  <span class="hljs-comment">//  [ 'c.txt', ... ]</span>
        }
    })
</code></pre>

	<button class="code-copy-button" data-clipboard-text="const list_targets: NM.Target[] = [NM.target({ name: 'b.txt', ... })]
async function* async_targets()
{
    yield 'c.txt'
    for await (...) yield ...
}

NM.target(
    {
        name: 'build',
        virtual: true, // like phony in Makefile
        deps: { a: 'a.txt', b: list_targets, c: async_targets },
        async build({ deps })
        {
            console.log(deps.a)  // 'a.txt'
            console.log(deps.b)  //  [ 'b.txt' ]
            console.log(deps.c)  //  [ 'c.txt', ... ]
        }
    })
">
        <span class="code-copy-icon"></span>
    </button>
</div>
<p>The mapping of dependencies to the <code>deps</code> parameter is as follows:</p>
<table>
<thead>
<tr>
<th style="text-align:center">Dependencies</th>
<th style="text-align:center">Inferenced Dependencies</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><code>BuildDependency</code></td>
<td style="text-align:center"><code>string</code></td>
</tr>
<tr>
<td style="text-align:center"><code>BuildDependency[]</code></td>
<td style="text-align:center"><code>string[]</code></td>
</tr>
<tr>
<td style="text-align:center"><code>AsyncGenerator&lt;BuildDependency&gt;</code></td>
<td style="text-align:center"><code>string[]</code></td>
</tr>
<tr>
<td style="text-align:center"><code>{ a: BuildDependency }</code></td>
<td style="text-align:center"><code>{ a: string }</code></td>
</tr>
<tr>
<td style="text-align:center"><code>{ a: BuildDependency[] }</code></td>
<td style="text-align:center"><code>{ a: string[] }</code></td>
</tr>
<tr>
<td style="text-align:center"><code>{ a: AsyncGenerator&lt;BuildDependency&gt; }</code></td>
<td style="text-align:center"><code>{ a: string[] }</code></td>
</tr>
</tbody>
</table>
<p>You might be refer to the <a href="#dependency-def">Dependency</a> definition.</p>
<h2 id="grouping-dependencies" tabindex="-1"><a href="#grouping-dependencies" class="header-anchor">Grouping Dependencies</a></h2>
<p>You can group dependencies using <code>Record</code>-style composition, which helps your organize your dependencies.</p>

<div style="position: relative">
	<pre><code class="language-typescript hljs"><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> <span class="hljs-variable constant_">NM</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'https://github.com/thautwarm/nomake/raw/v0.1.12/mod.ts'</span>

<span class="hljs-keyword">function</span> <span class="hljs-title function_">glob</span>(<span class="hljs-params">options: { root: <span class="hljs-built_in">string</span>, suffix: <span class="hljs-built_in">string</span>, excludeParts?: <span class="hljs-built_in">string</span>[] }</span>)
{
    <span class="hljs-keyword">const</span> { root, suffix, excludeParts } = options
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">NM</span>.<span class="hljs-title class_">Path</span>(root).<span class="hljs-title function_">fwalk</span>(
        <span class="hljs-function">(<span class="hljs-params">p</span>) =&gt;</span> p.<span class="hljs-title function_">endsWith</span>(suffix) &amp;&amp; !excludeParts?.<span class="hljs-title function_">some</span>(<span class="hljs-function"><span class="hljs-params">part</span> =&gt;</span> p.<span class="hljs-property">parts</span>.<span class="hljs-title function_">includes</span>(part)),
        { <span class="hljs-attr">includeDir</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">recursive</span>: <span class="hljs-literal">true</span> }
    )
}

<span class="hljs-variable constant_">NM</span>.<span class="hljs-title function_">target</span>(
    <span class="hljs-attr">name</span>: <span class="hljs-string">'./linux-x64/app'</span>,
    <span class="hljs-attr">deps</span>:
    {
        <span class="hljs-attr">cppSources</span>: <span class="hljs-title function_">glob</span>({ <span class="hljs-attr">root</span>: <span class="hljs-string">'src'</span>, <span class="hljs-attr">suffix</span>: <span class="hljs-string">'.cpp'</span>, <span class="hljs-attr">excludeParts</span>: [<span class="hljs-string">'generated'</span>] }),
        <span class="hljs-attr">libraries</span>: [<span class="hljs-string">'lib1.so'</span>, <span class="hljs-string">'lib2.so'</span>],
        <span class="hljs-keyword">async</span> <span class="hljs-title function_">build</span>(<span class="hljs-params"> { target, deps: { cppSources,  libraries }  } </span>)
        {
            <span class="hljs-comment">// you might do something like:</span>
            <span class="hljs-comment">// gcc $cppSources -l:$libraries -o $target</span>
        }
    })
</code></pre>

	<button class="code-copy-button" data-clipboard-text="import * as NM from 'https://github.com/thautwarm/nomake/raw/v0.1.12/mod.ts'

function glob(options: { root: string, suffix: string, excludeParts?: string[] })
{
    const { root, suffix, excludeParts } = options
    return new NM.Path(root).fwalk(
        (p) => p.endsWith(suffix) &amp;&amp; !excludeParts?.some(part => p.parts.includes(part)),
        { includeDir: false, recursive: true }
    )
}

NM.target(
    name: './linux-x64/app',
    deps:
    {
        cppSources: glob({ root: 'src', suffix: '.cpp', excludeParts: ['generated'] }),
        libraries: ['lib1.so', 'lib2.so'],
        async build( { target, deps: { cppSources,  libraries }  } )
        {
            // you might do something like:
            // gcc $cppSources -l:$libraries -o $target
        }
    })
">
        <span class="code-copy-icon"></span>
    </button>
</div>
<h2 id="virtual-targets" tabindex="-1"><a href="#virtual-targets" class="header-anchor">Virtual Targets</a></h2>
<p>A virtual target is a target that does not produce an artifact. It is analogous to the <code>PHONY</code> target in Makefile.</p>

<div style="position: relative">
	<pre><code class="language-typescript hljs"><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> <span class="hljs-variable constant_">NM</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'https://github.com/thautwarm/nomake/raw/v0.1.12/mod.ts'</span>

<span class="hljs-variable constant_">NM</span>.<span class="hljs-title function_">target</span>(
    {
        <span class="hljs-attr">name</span>: <span class="hljs-string">'clean'</span>,
        <span class="hljs-attr">virtual</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-keyword">async</span> <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>)
        {
            <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">NM</span>.<span class="hljs-title class_">Path</span>(<span class="hljs-string">'build'</span>).<span class="hljs-title function_">rm</span>(
                {
                    <span class="hljs-comment">// no worries as all the parameters have</span>
                    <span class="hljs-comment">// 1. **intellisense support**</span>
                    <span class="hljs-comment">// 2. **exhaustive type checking**</span>
                    <span class="hljs-comment">// 3. **documentations**</span>
                    <span class="hljs-attr">onError</span>: <span class="hljs-string">'ignore'</span>,
                    <span class="hljs-attr">recursive</span>: <span class="hljs-literal">true</span>
                }
            )
        }
    })
</code></pre>

	<button class="code-copy-button" data-clipboard-text="import * as NM from 'https://github.com/thautwarm/nomake/raw/v0.1.12/mod.ts'

NM.target(
    {
        name: 'clean',
        virtual: true,
        async build()
        {
            await new NM.Path('build').rm(
                {
                    // no worries as all the parameters have
                    // 1. **intellisense support**
                    // 2. **exhaustive type checking**
                    // 3. **documentations**
                    onError: 'ignore',
                    recursive: true
                }
            )
        }
    })
">
        <span class="code-copy-icon"></span>
    </button>
</div>
<h2 id="caching-%26-rebuilding" tabindex="-1"><a href="#caching-%26-rebuilding" class="header-anchor">Caching &amp; Rebuilding</a></h2>
<p>Similar to Makefile, NoMake provides a mechanism to automatically rebuild targets based on the changes in their dependencies.</p>
<p>However, flexibility are left to the user to specify the rebuild mode of the target.</p>
<p>The <code>rebuild</code> parameter of <code>target()</code> specifies the rebuild mode of the target. It can be one of the following:</p>
<ul>
<li><code>always</code>: always rebuild the target.</li>
<li><code>never</code>: never rebuild the target.</li>
<li><code>onChanged</code>: rebuild the target if any of its dependencies has been changed.</li>
</ul>
<div class="markdown-alert markdown-alert-note">
<p class="markdown-alert-title">Note</p>
<p>The default behavior when <code>rebuild</code> is not specified:</p>
<ol>
<li>When no <code>deps</code> are specified, <code>rebuild</code> is set to <code>always</code></li>
<li>When any <code>deps</code> are specified, <code>rebuild</code> is set to <code>onChanged</code></li>
</ol>
</div>
<p>The following code demonstrates the default behavior of the <code>rebuild</code> parameter:</p>

<div style="position: relative">
	<pre><code class="language-typescript hljs"><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> <span class="hljs-variable constant_">NM</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'https://github.com/thautwarm/nomake/raw/v0.1.12/mod.ts'</span>

<span class="hljs-variable constant_">NM</span>.<span class="hljs-title function_">target</span>(
    {
        <span class="hljs-attr">name</span>: <span class="hljs-string">'clean'</span>,
        <span class="hljs-attr">virtual</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-keyword">async</span> <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>)
        {
            <span class="hljs-comment">// this build logic will be always executed</span>
        }
    })

<span class="hljs-variable constant_">NM</span>.<span class="hljs-title function_">target</span>(
    {
        <span class="hljs-attr">name</span>: <span class="hljs-string">'output.txt'</span>,
        <span class="hljs-attr">deps</span>: [<span class="hljs-string">'input.txt'</span>],
        <span class="hljs-keyword">async</span> <span class="hljs-title function_">build</span>(<span class="hljs-params">{ deps, target }</span>)
        {
            <span class="hljs-comment">// this build logic will be executed only when 'input.txt' is changed</span>
        }
    })
</code></pre>

	<button class="code-copy-button" data-clipboard-text="import * as NM from 'https://github.com/thautwarm/nomake/raw/v0.1.12/mod.ts'

NM.target(
    {
        name: 'clean',
        virtual: true,
        async build()
        {
            // this build logic will be always executed
        }
    })

NM.target(
    {
        name: 'output.txt',
        deps: ['input.txt'],
        async build({ deps, target })
        {
            // this build logic will be executed only when 'input.txt' is changed
        }
    })
">
        <span class="code-copy-icon"></span>
    </button>
</div>
<h2 id="adding-documentations" tabindex="-1"><a href="#adding-documentations" class="header-anchor">Adding Documentations</a></h2>
<p>The <code>doc</code> parameter of <code>target()</code> specifies the documentation of the target.</p>
<p>So far, only virtual targets have been documented. The documentation of the target can be accessed via the <code>help</code> option.</p>

<div style="position: relative">
	<pre><code class="language-typescript hljs"><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> <span class="hljs-variable constant_">NM</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'https://github.com/thautwarm/nomake/raw/v0.1.12/mod.ts'</span>

<span class="hljs-variable constant_">NM</span>.<span class="hljs-title function_">option</span>(
    <span class="hljs-string">'legacy'</span>,
    {
        <span class="hljs-attr">callback</span>: <span class="hljs-function">(<span class="hljs-params">{ value }</span>) =&gt;</span> { <span class="hljs-comment">/* do stuff with value */</span> },
        <span class="hljs-attr">doc</span>: <span class="hljs-string">'Enable legacy mode.'</span>
    })

<span class="hljs-comment">// see parseOptions() for more details</span>
<span class="hljs-variable constant_">NM</span>.<span class="hljs-title function_">parseOptions</span>()

<span class="hljs-variable constant_">NM</span>.<span class="hljs-title function_">target</span>(
    {
        <span class="hljs-attr">name</span>: <span class="hljs-string">'build'</span>,
        <span class="hljs-attr">virtual</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">doc</span>: <span class="hljs-string">'This target generates the output file.'</span>,
        <span class="hljs-keyword">async</span> <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>)
        {
            <span class="hljs-comment">// build logic</span>
        }
    })

<span class="hljs-comment">// trigger the build process</span>
<span class="hljs-keyword">await</span> <span class="hljs-variable constant_">NM</span>.<span class="hljs-title function_">makefile</span>()
</code></pre>

	<button class="code-copy-button" data-clipboard-text="import * as NM from 'https://github.com/thautwarm/nomake/raw/v0.1.12/mod.ts'

NM.option(
    'legacy',
    {
        callback: ({ value }) => { /* do stuff with value */ },
        doc: 'Enable legacy mode.'
    })

// see parseOptions() for more details
NM.parseOptions()

NM.target(
    {
        name: 'build',
        virtual: true,
        doc: 'This target generates the output file.',
        async build()
        {
            // build logic
        }
    })

// trigger the build process
await NM.makefile()
">
        <span class="code-copy-icon"></span>
    </button>
</div>
<p>You can trigger the documentations by running the following command:</p>

<div style="position: relative">
	<pre><code class="language-bash hljs">sh&gt; deno run -A build.ts <span class="hljs-built_in">help</span>

Targets:
    [build] This target generates the output file.
Options:
    [-Dlegacy=value] Enable legacy mode.
</code></pre>

	<button class="code-copy-button" data-clipboard-text="sh> deno run -A build.ts help

Targets:
    [build] This target generates the output file.
Options:
    [-Dlegacy=value] Enable legacy mode.
">
        <span class="code-copy-icon"></span>
    </button>
</div>
</div></div></main></div><script src="/Site-33/js/clipboard.js"></script></body></html>